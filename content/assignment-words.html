<div class="page assignment-page active">
    <section class="hero-section">
        <div class="hero-bg">
            <img src="images/homeImage.webp" alt="Задание слова" class="hero-bg-image" loading="eager">
            <div class="hero-overlay"></div>
        </div>
        <div class="hero-content">
            <div class="container">
                <h1 class="hero-title">ЗАДАНИЕ: DRAG & DROP СЛОВА</h1>
                <p class="hero-description">
                    Интерактивное приложение для сортировки и перетаскивания слов с использованием JavaScript
                </p>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="section-header">
                <h2>Drag & Drop приложение "Слова"</h2>
                <p>Интерактивное приложение для работы со словами: сортировка, перетаскивание, группировка</p>
            </div>
            
            <!-- Встраиваем приложение прямо в страницу -->
            <div class="assignment-content">
                <style>
                    .words-container {
                        background: #f4f4f4;
                        padding: 2rem;
                        border-radius: var(--radius-2xl);
                        margin: 2rem auto;
                        max-width: 1200px;
                        text-align: center;
                    }
                    
                    .words-container h3 {
                        color: var(--color-green);
                        margin-bottom: 1.5rem;
                    }
                    
                    /* Основные стили приложения */
                    .words-app {
                        font-family: 'Montserrat', Arial, sans-serif;
                        width: 100%;
                        min-height: 600px;
                        background: white;
                        border-radius: var(--radius-xl);
                        padding: 2rem;
                        box-shadow: var(--shadow-md);
                        border: 1px solid var(--color-beige);
                        display: flex;
                        flex-direction: column;
                    }
                    
                    /* Стили блоков */
                    .words-block3 { 
                        width: 100%; 
                        height: 120px; 
                        border: 2px solid rgb(140, 17, 17); 
                        margin-bottom: 20px; 
                        background: #ffe5e5;
                        padding: 10px;
                        display: flex;
                        flex-wrap: wrap;
                        gap: 5px;
                        align-items: flex-start;
                        box-sizing: border-box;
                        overflow-y: auto;
                        font-family: 'Montserrat', Arial, sans-serif;
                        border-radius: var(--radius);
                    }

                    .words-layout {
                        display: flex;
                        gap: 20px;
                        width: 100%;
                        flex-grow: 1;
                        min-height: 400px;
                        font-family: 'Montserrat', Arial, sans-serif;
                    }

                    .words-block2 {
                        width: 30%;
                        border: 2px solid #000;
                        background: #ffffff;
                        padding: 10px;
                        overflow-y: auto;
                        box-sizing: border-box;
                        display: flex;
                        flex-wrap: wrap;
                        align-content: flex-start;
                        gap: 5px;
                        font-family: 'Montserrat', Arial, sans-serif;
                        border-radius: var(--radius);
                    }

                    .words-rightSide {
                        width: 70%;
                        display: flex;
                        flex-direction: column;
                        box-sizing: border-box;
                        font-family: 'Montserrat', Arial, sans-serif;
                        gap: 10px;
                    }

                    .words-upperInput {
                        display: flex;
                        gap: 10px;
                        width: 100%;
                        box-sizing: border-box;
                        font-family: 'Montserrat', Arial, sans-serif;
                    }

                    .words-inputText {
                        flex-grow: 1;
                        height: 34px;
                        padding: 4px 8px;
                        font-size: 14px;
                        box-sizing: border-box;
                        font-family: 'Montserrat', Arial, sans-serif;
                        border: 1px solid var(--color-beige);
                        border-radius: var(--radius);
                    }

                    .words-processBtn {
                        height: 34px;
                        padding: 0 12px;
                        font-size: 14px;
                        cursor: pointer;
                        background-color: var(--color-green);
                        color: white;
                        border: none;
                        border-radius: var(--radius);
                        font-family: 'Montserrat', Arial, sans-serif;
                        font-weight: 500;
                        transition: all 0.3s ease;
                    }

                    .words-processBtn:hover {
                        background-color: #45a049;
                        transform: scale(1.05);
                    }

                    .words-block1 {
                        flex-grow: 1;
                        border: 2px solid blue;
                        background: #e8f0ff;
                        padding: 10px;
                        box-sizing: border-box;
                        overflow-y: auto;
                        min-height: 300px;
                        position: relative;
                        font-family: 'Montserrat', Arial, sans-serif;
                        border-radius: var(--radius);
                    }

                    .words-item { 
                        padding: 8px 16px; 
                        background: #9fda9f; 
                        cursor: grab; 
                        user-select: none; 
                        border-radius: 20px 4px 4px 20px;
                        transition: transform 0.2s;
                        font-size: 14px;
                        height: fit-content;
                        font-family: 'Montserrat', Arial, sans-serif;
                        font-weight: 500;
                    }

                    .words-item:hover {
                        transform: scale(1.05);
                    }

                    .words-item.dragging {
                        opacity: 0.5;
                    }

                    .words-block3-item {
                        cursor: default;
                        font-family: 'Montserrat', Arial, sans-serif;
                        font-weight: 500;
                        padding: 6px 10px;
                        margin: 2px;
                        background: transparent;
                        border: none;
                    }
                    
                    /* Заглушки для пустых блоков */
                    .words-block2.empty::before,
                    .words-block1.empty::before,
                    .words-block3.empty::before {
                        content: attr(data-placeholder);
                        color: #666;
                        padding: 10px;
                        font-family: 'Montserrat', Arial, sans-serif;
                        display: block;
                        width: 100%;
                        text-align: center;
                    }
                    
                    .words-block2.empty::before {
                        content: "Блок 2 (исходные элементы)";
                    }
                    
                    .words-block1.empty::before {
                        content: "Блок 1 (зона перетаскивания)";
                    }
                    
                    .words-block3.empty::before {
                        content: "Блок 3 (нажмите на слова в синем блоке)";
                    }
                </style>
                
                <div class="words-container">
                    <h3>Drag & Drop приложение "Слова"</h3>
                    <div class="words-app" id="wordsApp">
                        <!-- Приложение будет сгенерировано JavaScript -->
                    </div>
                    
                    <div style="margin-top: 1rem; color: var(--color-text-light);">
                        Интерактивное приложение: введите слова, сортируйте, перетаскивайте и группируйте
                    </div>
                    
                    <div style="margin-top: 1rem; font-size: 0.875rem; color: var(--color-text-light); text-align: left; max-width: 800px; margin-left: auto; margin-right: auto;">
                        <strong>Инструкция:</strong>
                        <ol style="margin-top: 0.5rem; padding-left: 1.5rem;">
                            <li>Введите слова через дефис (например: лес-бочка-бык-крик-3-Бок)</li>
                            <li>Нажмите "Разобрать" для сортировки слов</li>
                            <li>Перетаскивайте слова из Блока 2 в Блок 1</li>
                            <li>Кликайте на слова в Блоке 1 для добавления в Блок 3</li>
                            <li>Возвращайте слова обратно в Блок 2 перетаскиванием</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="features-grid">
                <div class="feature-card card">
                    <h3>Технологии</h3>
                    <p>HTML5 Drag & Drop API, JavaScript, CSS Flexbox, DOM манипуляции</p>
                </div>
                
                <div class="feature-card card">
                    <h3>Функциональность</h3>
                    <p>Сортировка по категориям, перетаскивание элементов, динамическое обновление интерфейса</p>
                </div>
                
                <div class="feature-card card">
                    <h3>Сложность</h3>
                    <p>Средняя - обработка событий, работа с данными, реализация drag & drop</p>
                </div>
            </div>

            <div class="hero-actions" style="justify-content: center; margin-top: 3rem;">
                <button class="btn btn-primary" data-page="assignment-drawing">
                    ← К заданию "Рисунок CSS"
                </button>
                <button class="btn btn-primary" data-page="assignment-flexbox">
                    К заданию "Flexbox ролик" →
                </button>
            </div>
        </div>
    </section>
</div>

<script>
// Создаем и инициализируем приложение сразу
(function() {
    'use strict';
    
    console.log('Инициализация приложения "Слова"');
    
    // Создаем HTML структуру приложения
    function createAppStructure() {
        return `
            <div class="words-block3 empty" data-placeholder="Блок 3 (нажмите на слова в синем блоке)"></div>
            
            <div class="words-layout">
                <div class="words-block2 empty" data-placeholder="Блок 2 (исходные элементы)"></div>
                
                <div class="words-rightSide">
                    <div class="words-upperInput">
                        <input type="text" class="words-inputText" id="wordsInput" placeholder="лес-бочка-бык-крик-3-Бок" value="лес-бочка-бык-крик-3-Бок">
                        <button class="words-processBtn" id="wordsProcess">Разобрать</button>
                    </div>
                    
                    <div class="words-block1 empty" data-placeholder="Блок 1 (зона перетаскивания)"></div>
                </div>
            </div>
        `;
    }
    
    // Вставляем структуру приложения
    const wordsApp = document.getElementById('wordsApp');
    if (!wordsApp) {
        console.error('Не найден элемент wordsApp');
        return;
    }
    
    wordsApp.innerHTML = createAppStructure();
    console.log('Структура приложения создана');
    
    // Переменные приложения
    let originalOrder = [];
    let originalData = {};
    let selectedWords = new Set();
    let itemCounter = 0;
    
    // Функции приложения
    function randomColor() {
        return `hsl(${Math.random()*360},70%,70%)`;
    }
    
    function processWords() {
        console.log('Обработка слов...');
        const input = document.getElementById('wordsInput').value.trim();
        if (!input) {
            console.log('Ввод пустой');
            return;
        }
        
        let parts = input.split('-');
        console.log('Части:', parts);
        
        // Сортируем слова по категориям
        let lettersLower = parts.filter(w => /^[а-яa-z]/.test(w) && w[0] === w[0].toLowerCase()).sort();
        let lettersUpper = parts.filter(w => /^[А-ЯA-Z]/.test(w) && w[0] === w[0].toUpperCase()).sort();
        let numbers = parts.filter(w => /^\d+$/.test(w)).sort((a,b) => parseInt(a) - parseInt(b));
        
        // Создаем итоговый массив с ключами
        let final = [];
        lettersLower.forEach((w,i) => final.push({key:`a${i+1}`, value:w}));
        lettersUpper.forEach((w,i) => final.push({key:`b${i+1}`, value:w}));
        numbers.forEach((w,i) => final.push({key:`n${i+1}`, value:w}));
        
        originalOrder = final.map(f => f.value);
        
        // Очищаем и заполняем блок 2
        let block2 = document.querySelector('.words-block2');
        block2.innerHTML = '';
        block2.classList.remove('empty');
        itemCounter = 0;
        originalData = {};
        
        final.forEach(obj => {
            itemCounter++;
            let el = document.createElement('div');
            el.className = 'words-item';
            el.textContent = `${obj.key} ${obj.value}`;
            el.dataset.word = obj.value;
            el.dataset.key = obj.key;
            el.dataset.id = `item-${itemCounter}`;
            
            let baseColor = "#9fda9f";
            el.style.background = baseColor;
            
            // Сохраняем оригинальные данные
            originalData[`${obj.value}-${itemCounter}`] = {
                value: obj.value,
                key: obj.key,
                color: baseColor
            };
            
            el.draggable = true;
            
            // Добавляем обработчики
            el.addEventListener('dragstart', handleDragStart);
            el.addEventListener('click', function() {
                if (this.parentElement.classList.contains('words-block1')) {
                    addToBlock3(obj.value, this.dataset.id);
                }
            });
            
            block2.appendChild(el);
        });
        
        // Очищаем блок 1
        let block1 = document.querySelector('.words-block1');
        block1.innerHTML = '';
        block1.classList.add('empty');
        
        // Очищаем выбранные слова
        selectedWords.clear();
        updateBlock3();
        
        console.log('Обработка завершена, создано элементов:', itemCounter);
    }
    
    function addToBlock3(word, itemId) {
        console.log('Добавление в блок 3:', word, itemId);
        selectedWords.add(`${word}:${itemId}`);
        updateBlock3();
    }
    
    function removeFromBlock3(wordEntry) {
        console.log('Удаление из блока 3:', wordEntry);
        selectedWords.delete(wordEntry);
        updateBlock3();
    }
    
    function updateBlock3() {
        let b3 = document.querySelector('.words-block3');
        if (!b3) return;
        
        b3.innerHTML = '';
        
        if (selectedWords.size > 0) {
            b3.classList.remove('empty');
            selectedWords.forEach(wordEntry => {
                const [word, itemId] = wordEntry.split(':');
                
                let el = document.createElement('div');
                el.className = 'words-block3-item';
                el.textContent = word;
                el.dataset.itemId = itemId;
                
                b3.appendChild(el);
            });
        } else {
            b3.classList.add('empty');
        }
    }
    
    function handleDragStart(e) {
        console.log('Начало перетаскивания');
        const fullText = e.target.textContent;
        const word = fullText.split(' ')[1] || fullText;
        
        e.dataTransfer.setData('text', word);
        e.dataTransfer.setData('source', e.target.parentElement.className);
        e.dataTransfer.setData('itemId', e.target.dataset.id);
        e.dataTransfer.setData('fullText', fullText);
        
        e.target.classList.add('dragging');
    }
    
    function handleDrop(e) {
        e.preventDefault();
        console.log('Drop событие');
        
        let word = e.dataTransfer.getData('text');
        let source = e.dataTransfer.getData('source');
        let itemId = e.dataTransfer.getData('itemId');
        
        console.log('Данные:', {word, source, itemId});
        
        let item = document.querySelector(`.words-item[data-id="${itemId}"]`);
        if (!item) {
            console.error('Элемент не найден:', itemId);
            return;
        }
        
        item.classList.remove('dragging');
        
        const block1 = document.querySelector('.words-block1');
        const block2 = document.querySelector('.words-block2');
        
        if (!block1 || !block2) {
            console.error('Блоки не найдены');
            return;
        }
        
        const mouseX = e.clientX;
        const mouseY = e.clientY;
        
        const block1Rect = block1.getBoundingClientRect();
        const block2Rect = block2.getBoundingClientRect();
        
        const isOverBlock1 = mouseX >= block1Rect.left && mouseX <= block1Rect.right &&
                            mouseY >= block1Rect.top && mouseY <= block1Rect.bottom;
        
        const isOverBlock2 = mouseX >= block2Rect.left && mouseX <= block2Rect.right &&
                            mouseY >= block2Rect.top && mouseY <= block2Rect.bottom;
        
        if (isOverBlock1) {
            console.log('Перемещение в Block1');
            if (source.includes('words-block2')) {
                item.style.background = randomColor();
            }
            
            item.style.position = 'absolute';
            item.style.left = `${mouseX - block1Rect.left - 40}px`;
            item.style.top = `${mouseY - block1Rect.top - 15}px`;
            
            block1.appendChild(item);
            block1.classList.remove('empty');
            
        } else if (isOverBlock2) {
            console.log('Возвращение в Block2');
            const wordKey = `${word}-${itemId}`;
            if (originalData[wordKey]) {
                item.style.background = originalData[wordKey].color || "#9fda9f";
            } else {
                item.style.background = "#9fda9f";
            }
            
            item.style.position = '';
            item.style.left = '';
            item.style.top = '';
            
            // Удаляем из блока 3 если есть
            let toRemove = null;
            selectedWords.forEach(entry => {
                if (entry.includes(`:${itemId}`)) {
                    toRemove = entry;
                }
            });
            if (toRemove) {
                removeFromBlock3(toRemove);
            }
            
            // Восстанавливаем сортировку
            let block2Items = [...block2.querySelectorAll('.words-item')];
            
            // Сортируем по ключам
            block2Items.sort((a, b) => {
                let aKey = a.dataset.key;
                let bKey = b.dataset.key;
                
                if (aKey[0] !== bKey[0]) {
                    return aKey[0].localeCompare(bKey[0]);
                }
                return parseInt(aKey.slice(1)) - parseInt(bKey.slice(1));
            });
            
            block2.innerHTML = '';
            
            // Добавляем текущий элемент если его нет в списке
            if (!block2Items.find(el => el.dataset.id === itemId)) {
                block2Items.push(item);
            }
            
            // Снова сортируем
            block2Items.sort((a, b) => {
                let aKey = a.dataset.key;
                let bKey = b.dataset.key;
                
                if (aKey[0] !== bKey[0]) {
                    return aKey[0].localeCompare(bKey[0]);
                }
                return parseInt(aKey.slice(1)) - parseInt(bKey.slice(1));
            });
            
            block2Items.forEach(el => {
                block2.appendChild(el);
            });
            
            // Проверяем, не пустой ли блок 1
            if (block1.querySelectorAll('.words-item').length === 0) {
                block1.classList.add('empty');
            }
        }
    }
    
    // Назначаем обработчики событий
    document.getElementById('wordsProcess').addEventListener('click', processWords);
    
    // Обработка Enter в поле ввода
    document.getElementById('wordsInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            processWords();
        }
    });
    
    // Глобальные обработчики drag & drop
    document.addEventListener('dragover', function(e) {
        e.preventDefault();
    });
    
    document.addEventListener('dragend', function() {
        document.querySelectorAll('.words-item.dragging').forEach(el => {
            el.classList.remove('dragging');
        });
    });
    
    document.addEventListener('drop', handleDrop);
    
    // Запускаем обработку тестовых данных
    console.log('Запуск обработки тестовых данных...');
    setTimeout(processWords, 100);
    
})();
</script>

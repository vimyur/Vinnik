<div class="page assignment-page active">
    <section class="hero-section">
        <div class="hero-bg">
            <img src="images/homeImage.webp" alt="Задание слова" class="hero-bg-image" loading="eager">
            <div class="hero-overlay"></div>
        </div>
        <div class="hero-content">
            <div class="container">
                <h1 class="hero-title">ЗАДАНИЕ: DRAG & DROP СЛОВА</h1>
                <p class="hero-description">
                    Интерактивное приложение для сортировки и перетаскивания слов с использованием JavaScript
                </p>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="section-header">
                <h2>Drag & Drop приложение "Слова"</h2>
                <p>Интерактивное приложение для работы со словами: сортировка, перетаскивание, группировка</p>
            </div>
            
            <!-- Встраиваем приложение прямо в страницу -->
            <div class="assignment-content">
                <style>
                    .words-container {
                        background: #f4f4f4;
                        padding: 2rem;
                        border-radius: var(--radius-2xl);
                        margin: 2rem auto;
                        max-width: 1200px;
                        text-align: center;
                    }
                    
                    .words-container h3 {
                        color: var(--color-green);
                        margin-bottom: 1.5rem;
                    }
                    
                    /* Стили для приложения */
                    .words-app-wrapper {
                        background: white;
                        border-radius: var(--radius-xl);
                        padding: 2rem;
                        box-shadow: var(--shadow-md);
                        border: 1px solid var(--color-beige);
                        min-height: 600px;
                    }
                    
                    /* Адаптация стилей приложения */
                    #wordsApp {
                        font-family: 'Montserrat', Arial, sans-serif;
                        margin: 0;
                        padding: 0;
                        background: #f7f7f7;
                        height: 100%;
                    }
                    
                    #wordsApp .block3 {
                        width: 100%;
                        height: 120px;
                        border: 2px solid rgb(140, 17, 17);
                        margin-bottom: 20px;
                        background: #ffe5e5;
                        padding: 10px;
                        display: flex;
                        flex-wrap: wrap;
                        gap: 5px;
                        align-items: flex-start;
                        box-sizing: border-box;
                        overflow-y: auto;
                        font-family: 'Montserrat', Arial, sans-serif;
                    }
                    
                    #wordsApp .layout {
                        display: flex;
                        gap: 20px;
                        width: 100%;
                        height: calc(100vh - 400px);
                        min-height: 400px;
                        font-family: 'Montserrat', Arial, sans-serif;
                    }
                    
                    #wordsApp .block2 {
                        width: 30%;
                        border: 2px solid #000;
                        background: #ffffff;
                        padding: 10px;
                        overflow-y: auto;
                        box-sizing: border-box;
                        display: flex;
                        flex-wrap: wrap;
                        align-content: flex-start;
                        gap: 5px;
                        font-family: 'Montserrat', Arial, sans-serif;
                    }
                    
                    #wordsApp .rightSide {
                        width: 70%;
                        display: flex;
                        flex-direction: column;
                        box-sizing: border-box;
                        font-family: 'Montserrat', Arial, sans-serif;
                    }
                    
                    #wordsApp .upperInput {
                        display: flex;
                        gap: 10px;
                        margin-bottom: 10px;
                        width: 100%;
                        box-sizing: border-box;
                        font-family: 'Montserrat', Arial, sans-serif;
                    }
                    
                    #wordsApp .inputText {
                        flex-grow: 1;
                        height: 34px;
                        padding: 4px 8px;
                        font-size: 14px;
                        box-sizing: border-box;
                        font-family: 'Montserrat', Arial, sans-serif;
                        border: 1px solid var(--color-beige);
                        border-radius: var(--radius);
                    }
                    
                    #wordsApp .processBtn {
                        height: 34px;
                        padding: 0 12px;
                        font-size: 14px;
                        cursor: pointer;
                        background-color: var(--color-green);
                        color: white;
                        border: none;
                        border-radius: var(--radius);
                        font-family: 'Montserrat', Arial, sans-serif;
                        font-weight: 500;
                        transition: all 0.3s ease;
                    }
                    
                    #wordsApp .processBtn:hover {
                        background-color: #45a049;
                        transform: scale(1.05);
                    }
                    
                    #wordsApp .block1 {
                        flex-grow: 1;
                        border: 2px solid blue;
                        background: #e8f0ff;
                        padding: 10px;
                        box-sizing: border-box;
                        overflow-y: auto;
                        min-height: 300px;
                        position: relative;
                        font-family: 'Montserrat', Arial, sans-serif;
                    }
                    
                    #wordsApp .item {
                        padding: 8px 16px;
                        background: #9fda9f;
                        cursor: grab;
                        user-select: none;
                        border-radius: 20px 4px 4px 20px;
                        transition: transform 0.2s;
                        font-size: 14px;
                        height: fit-content;
                        font-family: 'Montserrat', Arial, sans-serif;
                        font-weight: 500;
                        margin: 2px;
                    }
                    
                    #wordsApp .item:hover {
                        transform: scale(1.05);
                    }
                    
                    #wordsApp .item.dragging {
                        opacity: 0.5;
                    }
                    
                    #wordsApp .block3-item {
                        cursor: default;
                        font-family: 'Montserrat', Arial, sans-serif;
                        font-weight: 500;
                        padding: 6px 10px;
                        margin: 2px;
                        background: transparent;
                        border: none;
                    }
                    
                    /* Заглушка для пустых блоков */
                    #wordsApp .block2:empty::after,
                    #wordsApp .block1:empty::after,
                    #wordsApp .block3:empty::after {
                        content: attr(data-placeholder);
                        color: #666;
                        padding: 10px;
                        font-family: 'Montserrat', Arial, sans-serif;
                        display: block;
                    }
                    
                    #wordsApp .block2:empty::after {
                        content: "Блок 2 (исходные элементы)";
                    }
                    
                    #wordsApp .block1:empty::after {
                        content: "Блок 1 (зона перетаскивания)";
                    }
                    
                    #wordsApp .block3:empty::after {
                        content: "Блок 3 (нажмите на слова в синем блоке)";
                    }
                </style>
                
                <div class="words-container">
                    <h3>Drag & Drop приложение "Слова"</h3>
                    <div class="words-app-wrapper">
                        <!-- Приложение будет вставлено здесь -->
                        <div id="wordsApp"></div>
                    </div>
                    
                    <div style="margin-top: 1rem; color: var(--color-text-light);">
                        Интерактивное приложение: введите слова, сортируйте, перетаскивайте и группируйте
                    </div>
                    
                    <div style="margin-top: 1rem; font-size: 0.875rem; color: var(--color-text-light); text-align: left; max-width: 800px; margin-left: auto; margin-right: auto;">
                        <strong>Инструкция:</strong>
                        <ol style="margin-top: 0.5rem; padding-left: 1.5rem;">
                            <li>Введите слова через дефис (например: лес-бочка-бык-крик-3-Бок)</li>
                            <li>Нажмите "Разобрать" для сортировки слов</li>
                            <li>Перетаскивайте слова из Блока 2 в Блок 1</li>
                            <li>Кликайте на слова в Блоке 1 для добавления в Блок 3</li>
                            <li>Возвращайте слова обратно в Блок 2 перетаскиванием</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div class="features-grid">
                <div class="feature-card card">
                    <h3>Технологии</h3>
                    <p>HTML5 Drag & Drop API, JavaScript, CSS Flexbox, DOM манипуляции</p>
                </div>
                
                <div class="feature-card card">
                    <h3>Функциональность</h3>
                    <p>Сортировка по категориям, перетаскивание элементов, динамическое обновление интерфейса</p>
                </div>
                
                <div class="feature-card card">
                    <h3>Сложность</h3>
                    <p>Средняя - обработка событий, работа с данными, реализация drag & drop</p>
                </div>
            </div>

            <div class="hero-actions" style="justify-content: center; margin-top: 3rem;">
                <button class="btn btn-primary" data-page="assignment-drawing">
                    ← К заданию "Рисунок CSS"
                </button>
                <button class="btn btn-primary" data-page="assignment-flexbox">
                    К заданию "Flexbox ролик" →
                </button>
            </div>
        </div>
    </section>
</div>

<script>
// Инициализация приложения после загрузки страницы
document.addEventListener('DOMContentLoaded', function() {
    console.log('Инициализация приложения "Слова"...');
    
    // Создаем HTML структуру
    const wordsApp = document.getElementById('wordsApp');
    if (!wordsApp) {
        console.error('Не найден элемент wordsApp');
        return;
    }
    
    wordsApp.innerHTML = `
        <div class="block3" data-placeholder="Блок 3 (нажмите на слова в синем блоке)"></div>
        
        <div class="layout">
            <div class="block2" data-placeholder="Блок 2 (исходные элементы)"></div>
            
            <div class="rightSide">
                <div class="upperInput">
                    <input type="text" class="inputText" id="wordsInput" placeholder="лес-бочка-бык-крик-3-Бок">
                    <button class="processBtn" id="wordsProcess">Разобрать</button>
                </div>
                
                <div class="block1" data-placeholder="Блок 1 (зона перетаскивания)"></div>
            </div>
        </div>
    `;
    
    console.log('Структура приложения создана');
    
    // Инициализируем переменные приложения
    let originalOrder = [];
    let originalData = {};
    let selectedWords = new Set();
    let itemCounter = 0;
    
    // Функции приложения
    function randomColor() {
        return `hsl(${Math.random()*360},70%,70%)`;
    }
    
    function processWords() {
        console.log('Обработка слов...');
        const input = document.getElementById('wordsInput').value.trim();
        if (!input) {
            console.log('Ввод пустой');
            return;
        }
        
        console.log('Ввод:', input);
        let parts = input.split('-');
        console.log('Части:', parts);
        
        let lettersLower = parts.filter(w => /^([а-яa-z]).*/i.test(w) && w[0] === w[0].toLowerCase()).sort();
        let lettersUpper = parts.filter(w => /^([А-ЯA-Z]).*/i.test(w) && w[0] === w[0].toUpperCase()).sort();
        let numbers = parts.filter(w => /^\d+$/.test(w)).sort((a,b)=>parseInt(a)-parseInt(b));
        
        console.log('Строчные:', lettersLower);
        console.log('Заглавные:', lettersUpper);
        console.log('Числа:', numbers);
        
        let final = [];
        lettersLower.forEach((w,i)=>final.push({key:`a${i+1}`, value:w}));
        lettersUpper.forEach((w,i)=>final.push({key:`b${i+1}`, value:w}));
        numbers.forEach((w,i)=>final.push({key:`n${i+1}`, value:w}));
        
        originalOrder = final.map(f=>f.value);
        console.log('Итоговый порядок:', originalOrder);
        
        let block2 = document.querySelector('#wordsApp .block2');
        block2.innerHTML = '';
        itemCounter = 0;
        originalData = {};
        
        final.forEach(obj => {
            itemCounter++;
            let el = document.createElement('div');
            el.className = 'item';
            el.innerText = `${obj.key} ${obj.value}`;
            el.dataset.word = obj.value;
            el.dataset.key = obj.key;
            el.dataset.id = `item-${itemCounter}`;
            
            let baseColor = "#9fda9f";
            el.style.background = baseColor;
            
            originalData[`${obj.value}-${itemCounter}`] = {
                value: obj.value,
                key: obj.key,
                color: baseColor
            };
            
            el.draggable = true;
            
            // Обработчики событий
            el.addEventListener('dragstart', handleDragStart);
            el.addEventListener('click', function() {
                console.log('Клик по элементу:', obj.value);
                if (this.parentElement.classList.contains('block1')) {
                    addToBlock3(obj.value, this.dataset.id);
                }
            });
            
            block2.appendChild(el);
        });
        
        document.querySelector('#wordsApp .block1').innerHTML = '';
        selectedWords.clear();
        updateBlock3();
        
        console.log('Обработка завершена, создано элементов:', itemCounter);
    }
    
    function addToBlock3(word, itemId) {
        console.log('Добавление в блок 3:', word, itemId);
        selectedWords.add(`${word}:${itemId}`);
        updateBlock3();
    }
    
    function removeFromBlock3(wordEntry) {
        console.log('Удаление из блока 3:', wordEntry);
        selectedWords.delete(wordEntry);
        updateBlock3();
    }
    
    function updateBlock3() {
        console.log('Обновление блока 3, элементов:', selectedWords.size);
        let b3 = document.querySelector('#wordsApp .block3');
        if (!b3) {
            console.error('Не найден блок 3');
            return;
        }
        
        b3.innerHTML = '';
        
        selectedWords.forEach(wordEntry => {
            const [word, itemId] = wordEntry.split(':');
            
            let el = document.createElement('div');
            el.className = 'block3-item';
            el.innerText = word;
            el.dataset.itemId = itemId;
            
            b3.appendChild(el);
        });
        
        if (selectedWords.size === 0) {
            b3.innerHTML = '<div style="color: #666; padding: 10px; font-family: Montserrat, Arial, sans-serif;">Блок 3 (кликните на слова в синем блоке)</div>';
        }
        
        console.log('Блок 3 обновлен');
    }
    
    function handleDragStart(e) {
        console.log('Начало перетаскивания');
        const fullText = e.target.innerText;
        const word = fullText.split(' ')[1] || fullText;
        
        e.dataTransfer.setData('text', word);
        e.dataTransfer.setData('source', e.target.parentElement.className);
        e.dataTransfer.setData('itemId', e.target.dataset.id);
        e.dataTransfer.setData('fullText', fullText);
        
        e.target.classList.add('dragging');
    }
    
    // Глобальные обработчики событий
    document.getElementById('wordsProcess').addEventListener('click', processWords);
    
    // Обработка Enter в поле ввода
    document.getElementById('wordsInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            processWords();
        }
    });
    
    // Обработчики drag & drop
    document.addEventListener('dragover', function(e) {
        e.preventDefault();
    });
    
    document.addEventListener('dragend', function(e) {
        console.log('Завершение перетаскивания');
        document.querySelectorAll('#wordsApp .item.dragging').forEach(el => {
            el.classList.remove('dragging');
        });
    });
    
    document.addEventListener('drop', function(e) {
        e.preventDefault();
        console.log('Drop событие');
        
        let word = e.dataTransfer.getData('text');
        let source = e.dataTransfer.getData('source');
        let itemId = e.dataTransfer.getData('itemId');
        
        console.log('Данные:', {word, source, itemId});
        
        let item = document.querySelector(`#wordsApp .item[data-id="${itemId}"]`);
        if (!item) {
            console.error('Элемент не найден:', itemId);
            return;
        }
        
        item.classList.remove('dragging');
        
        const block1 = document.querySelector('#wordsApp .block1');
        const block2 = document.querySelector('#wordsApp .block2');
        
        if (!block1 || !block2) {
            console.error('Блоки не найдены');
            return;
        }
        
        const mouseX = e.clientX;
        const mouseY = e.clientY;
        
        const block1Rect = block1.getBoundingClientRect();
        const block2Rect = block2.getBoundingClientRect();
        
        const isOverBlock1 = mouseX >= block1Rect.left && mouseX <= block1Rect.right &&
                            mouseY >= block1Rect.top && mouseY <= block1Rect.bottom;
        
        const isOverBlock2 = mouseX >= block2Rect.left && mouseX <= block2Rect.right &&
                            mouseY >= block2Rect.top && mouseY <= block2Rect.bottom;
        
        console.log('Координаты:', {mouseX, mouseY});
        console.log('Block1 rect:', block1Rect);
        console.log('Block2 rect:', block2Rect);
        console.log('Over Block1:', isOverBlock1);
        console.log('Over Block2:', isOverBlock2);
        
        if (isOverBlock1) {
            console.log('Перемещение в Block1');
            if (source.includes('block2')) {
                item.style.background = randomColor();
            }
            
            item.style.position = 'absolute';
            item.style.left = `${mouseX - block1Rect.left - 40}px`;
            item.style.top = `${mouseY - block1Rect.top - 15}px`;
            
            block1.appendChild(item);
            
        } else if (isOverBlock2) {
            console.log('Возвращение в Block2');
            const wordKey = `${word}-${itemId}`;
            if (originalData[wordKey]) {
                item.style.background = originalData[wordKey].color || "#9fda9f";
            } else {
                item.style.background = "#9fda9f";
            }
            
            item.style.position = '';
            item.style.left = '';
            item.style.top = '';
            
            // Удаляем из блока 3 если есть
            let toRemove = null;
            selectedWords.forEach(entry => {
                if (entry.includes(`:${itemId}`)) {
                    toRemove = entry;
                }
            });
            if (toRemove) {
                removeFromBlock3(toRemove);
            }
            
            // Восстанавливаем сортировку
            let block2Items = [...block2.querySelectorAll('.item')];
            
            let sortedItems = block2Items.sort((a, b) => {
                let aKey = a.dataset.key;
                let bKey = b.dataset.key;
                
                if (aKey[0] !== bKey[0]) {
                    return aKey[0].localeCompare(bKey[0]);
                }
                return parseInt(aKey.slice(1)) - parseInt(bKey.slice(1));
            });
            
            block2.innerHTML = '';
            
            let allItems = [...sortedItems];
            if (!sortedItems.find(el => el.dataset.id === itemId)) {
                allItems.push(item);
            }
            
            allItems.sort((a, b) => {
                let aKey = a.dataset.key;
                let bKey = b.dataset.key;
                
                if (aKey[0] !== bKey[0]) {
                    return aKey[0].localeCompare(bKey[0]);
                }
                return parseInt(aKey.slice(1)) - parseInt(bKey.slice(1));
            });
            
            allItems.forEach(el => {
                block2.appendChild(el);
            });
        }
        
        console.log('Drop завершен');
    });
    
    // Тестовые данные для демонстрации
    console.log('Инициализация завершена');
    
    // Автозаполнение тестовыми данными для демонстрации
    setTimeout(() => {
        document.getElementById('wordsInput').value = 'лес-бочка-бык-крик-3-Бок';
        processWords();
    }, 100);
});
</script>
